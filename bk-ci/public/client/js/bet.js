function ngaychange(a){document.betform.ngay.value=normaldate(a);$("#ngaydisplay").html(normaldate(a));ngaybet=sqldate(a);cleartt();betupdate(1);return false}function betformsubmit(){if(!curruser){alert("Bạn phải đăng nhập mới sử dụng được chức năng này")}else{if(editrestrict&&!chuaquay(ngaybet)){alert("Đã hết giờ ghi lô ngày "+normaldate(ngaybet)+". Bạn có thể chọn ngày khác trong mục LOTTO ONLINE")}else{betupdate()}}return false}function edit_allow_check(){if(editrestrict&&!chuaquay(ngaybet)){document.betform.betsubmit.disabled=true;$("#betform").attr("title","Đã hết giờ ghi lô ngày "+normaldate(ngaybet))}else{$("#betform").removeAttr("title");document.betform.betsubmit.disabled=false}}function betupdate(b){edit_allow_check();var a=document.betform;if(b){$(".bet").remove();$("#betcontainer").append("<img id=betloadingimg src='"+uri_root+"public/client/images/loading6.gif'>");$("#betarea").show();betdbupdate("","",ngaybet,"","",betupdatefinish)}else{if(a.range.value!=""&&a.bet.value!=""){if(is_tet(ngaybet)){alert("XSTĐ nghỉ tết không mở thưởng ngày "+normaldate(ngaybet))}else{if(betlimit&&a.bet.value>betlimit){alert("Bạn chỉ được ghi tối đa "+betlimit+" điểm cho mỗi cặp số")}else{$("#betcontainer").append("<img id=betloadingimg src='"+uri_root+"public/client/images/loading6.gif'>");$("#betarea").show();betdbupdate(a.range.value,a.bet.value,ngaybet,"","",betupdatefinish);a.range.value="";a.bet.value=""}}}else{alert("Vui lòng nhập cặp số và số điểm bạn muốn chơi")}}return false}function betupdatefinish(c){$("#betloadingimg").remove();if(c){bets=c.split("|");for(var b in bets){var a=bets[b].split(":");if($("#bet_"+a[0]).length>0){if(a[1]>0){$("#betvalue_"+a[0]).html(a[1]);$("#bet_"+a[0]).removeClass("selected");$("#bet_"+a[0]).addClass("hilight");setTimeout('$("#bet_'+a[0]+'").removeClass("hilight")',1000);$("div.bet > .deletebutton").remove()}else{$("#bet_"+a[0]).hide("fast",function(){});$("#betvalue_"+a[0]).html("0");setTimeout('$("#bet_'+a[0]+'").remove()',500)}}else{if(a[1]>0){var d=$("<div id='bet_"+a[0]+"' class=bet style='display:none'><span class=betnum>"+a[0]+"</span><br><span class=bet_value id=betvalue_"+a[0]+">"+a[1]+"</span>&nbsp;điểm</div>");d.click(function(){betselect(this.id)});d.hover(function(){$(this).addClass("bet_hover")},function(){$(this).removeClass("bet_hover")});$("#betcontainer").append(d);$(d).show("fast")}}}diem=0;$("span.bet_value").each(function(e,f){diem+=parseInt($(f).html())});$("#tongdiem").html(diem+"&nbsp;");$("#tongchi").html(diem*23+"&nbsp;k");bet_checkkq(1)}if($("#betcontainer").children().length>0){$("#betarea").show()}else{$("#betarea").hide()}}function unbet(a){a=a.split("_");betdbupdate(a[1],0,ngaybet,"","",betupdatefinish);return false}function betselect(b){$("div.bet.selected").removeClass("selected");$("#"+b).addClass("selected");if(!editrestrict||chuaquay(ngaybet)){$("div.bet > .deletebutton").remove();$("#"+b).append("<a class='deletebutton' style='top:-5px; right:-5px' href='#' onclick='return unbet(\""+b+"\")' title='Bỏ'></a>");var a=document.betform;var b=b.split("_");a.range.value=b[1];a.bet.value=$("#betvalue_"+b[1]).html();hilightform()}}function betls_click(b,a){if(document.betform){document.betform.range.value=b;document.betform.bet.value=a}}function choitiep(a){if(document.betform){if(sqldate(ngaybet)!=nextday){ngaychange(nextday)}document.betform.range.value=a;document.betform.bet.focus();hilightform()}}function bet_checkkq(a,b){if($("span.betnum").length){if(typeof(b)!="undefined"){diemthang=0;$("span.betnum").each(function(d,f){var c=$(f).html();var e=solo(b,c);if(e[0]){$("#bet_"+c).addClass("trung");$("#bet_"+c+" > .nhay").remove();$("#bet_"+c).append("<div class=nhay>"+e[0]+"</div>");diemthang+=$("#betvalue_"+c).html()*e[0];$("#tongnhan").html(diemthang*80+"&nbsp;k")}if(b[0]){updatett()}})}else{if(intime()||a){$.ajax({url:uri_root+"lol_betkq?ngay="+ngaybet,cache:false,success:function(g){if(g){var c=g.split("|");diemthang=0;if(c.length>0){for(var f in c){var e=c[f]=="finish";if(!e){var d=c[f].split(":");$("#bet_"+d[0]).addClass("trung");$("#bet_"+d[0]).append("<div class=nhay>"+d[1]+"</div>");diemthang+=$("#betvalue_"+d[0]).html()*d[1]}}$("#tongnhan").html(diemthang*80+"&nbsp;k");if(e){updatett()}}}}})}}}}function updatett(){tt=diemthang*80-diem*23;$("#thangthua").html(tt+"&nbsp;k");$("#thangthua").css("background-color",tt>0?"#00A000":"#EE0000")}function cleartt(){$("#thangthua").html("--");$("#thangthua").css("background-color","#616A89")}function refresh_balance(){if($("span.betnum").length){$.ajax({url:"getbalance.php",success:function(a){if(a){a=a.split(":");balancedate=a[0];balance=a[1];$("#balanceplace").html(number_format(balance,0,",","."));if(balance>0){$("#balanceplace").removeClass("neg");$("#balanceplace").addClass("pos")}else{$("#balanceplace").removeClass("pos");$("#balanceplace").addClass("neg")}}}})}}var betlsloading=0;function loadbetls(a){if(!betlsloading){betlsloading=1;$("#lichsu").append("<div id='betlsloadingimg' style='margin:10'><img src='"+uri_root+"public/client/images/loading5.gif'></div>");$.ajax({url:uri_root+"lol_betlist?ngay="+a,cache:false,success:function(c){if(c){var d=c.split("|");for(i in d){var k=0,h=0,e=0;var f=d[i];f=f.split("~");ngayls=f[0];var g=f[1].split(",");var l="<table class=lichsu cellspacing=1 cellpadding=5><tr><th width=\"175\">Ngày</th><th width=\"45\">Lô</th><th width=\"80\">Điểm</th><th width=\"80\">Nháy</th><th>Tiền</th></tr>";for(j in g){num=g[j].split(":");k+=num[1]*1;h+=num[1]*num[2];l+="<tr>";if(j==0){l+="<td valign=top rowspan='"+g.length+"'><a href='#betplace' onclick='return ngaychange(\""+f[0]+"\")'>"+f[0]+"</a></td>"}var b=num[2]*num[1]*80-num[1]*23;l+="<td><a href='#' class='betnum_ls' onclick='betls_click(\""+num[0]+'","'+num[1]+"\");return false'>"+num[0]+"</a></td><td>"+num[1]+"</td><td>"+num[2]+"</td><td class='"+(b>0?"pos":"neg")+"'>"+b+"</tr>"}l+="<tr class='lichsu_lastrow'><td colspan=2><span style='font-weight:normal; color:#274B69'>Tài&nbsp;khoản:</span>&nbsp;<span class='"+(f[2]>0?"pos":"neg")+"'>"+f[2]+"</span></td><td>"+k+"</td><td>"+h+"</td><td class='"+(h*80-k*23>0?"pos":"neg")+"'>"+(h*80-k*23)+"</td></tr>";l+="</table>";$("#lichsu").append(l)}}betlsloading=0;$("#betlsloadingimg").remove()}})}}function hilightform(){$("#betform").css("background-color","#F4DFFF");setTimeout("$('#betform').css('background-color','#E4B3FF')",200);setTimeout("$('#betform').css('background-color','#F4DFFF')",800);setTimeout("$('#betform').css('background-color','#FFFFFF')",1000)};