function chotsw(b){if($("#chotform").is(":visible")){$("#chotform").hide("fast");$(b).find(".updownarr").html("▼")}else{$("#chotform").show("fast");$(b).find(".updownarr").html("▲")}}function lockchotform(){chotlock=1;document.chotform.chot_submit.disabled=true}function unlockchotform(){chotlock=0;document.chotform.chot_submit.disabled=false}function chotso(){if(!chotlock){if(!chuaquay(ngaychot)){alert("Đã hết giờ chốt số ngày "+normaldate(ngaychot))}else{var lo=document.chotform.chotlo.value;var lodau=document.chotform.chotlodau.value;var lodit=document.chotform.chotlodit.value;var lobt=document.chotform.chotlobt.value;var de=document.chotform.chotde.value;var dedau=document.chotform.chotdedau.value;var dedit=document.chotform.chotdedit.value;var debt=document.chotform.chotdebt.value;if(!lo.length&&!lodau.length&&!lodit.length&&!lobt.length&&!de.length&&!dedau.length&&!dedit.length&&!debt.length){alert("Bạn phải nhập ít nhất 1 số")}else{lockchotform();$("#chotmsgplace").html("<span class=msg>Đang cập nhật...</span>");$.ajax({url:uri_root+"chat_chot?chotsubmit&ngay="+ngaychot+"&lo="+lo+"&lodau="+lodau+"&lodit="+lodit+"&lobt="+lobt+"&de="+de+"&dedau="+dedau+"&dedit="+dedit+"&debt="+debt,success:function(html){$("#chotmsgplace").html("");if(html.length>0){var re=eval("("+html+")");if(re.error){var msg=$("<span class=msgerr>"+re.msg+"</span>");$("#chotmsgplace").append(msg);setTimeout(function(){msg.fadeOut("slow",function(){msg.remove()})},3000);unlockchotform()}else{var msg=$("<span class=msg>"+re.msg+"</span>");$("#chotmsgplace").append(msg);setTimeout(function(){msg.fadeOut("slow",function(){msg.remove()})},3000);showcurrent(re.data)}}},error:function(){$("#chotmsgplace").html("<span class=alert>Không thể kết nối với máy chủ, xin hãy thử lại</span>");unlockchotform()}})}}}}function showcurrent(b){if(typeof(b)=="object"){var a=b.ut?b.ut:b.ct;$("#chotstatus").html("Cập nhật lúc "+timeshow(a));document.chotform.chotlo.value=b.lo.join(",");document.chotform.chotlodau.value=b.lodau.join(",");document.chotform.chotlodit.value=b.lodit.join(",");document.chotform.chotlobt.value=b.lobt;document.chotform.chotde.value=b.de.join(",");document.chotform.chotdedau.value=b.dedau.join(",");document.chotform.chotdedit.value=b.dedit.join(",");document.chotform.chotdebt.value=b.debt}}function clearchotform(){$(".chotinput").val("")}function chotlist(ngaychot,init){var update=chuaquay(ngaychot);if(update||init){$.ajax({url:uri_root+"chat_chot?getlist&ngay="+ngaychot+"&lastid="+(update?lastchotid:"0")+"&lastupdate="+(update?lastchotupdate:"0"),timeout:chotlist_timeout,success:function(html){$("#chotlistarea"+ngaychot).find(".loadingimg").remove();if(html.length>0){var re=eval("("+html+")");if(update){lastchotid=re.lastid;lastchotupdate=re.lastupdate}var list=re.list;var newchot=0;for(i in list){var chot=list[i];var trunglo=0;var trungde=0;var chotuserinfo='<div style="font-size:11px"><b style="font-size:11px">'+chot.email+"</b>";if(typeof(chot.ratio)!="undefined"){chotuserinfo+='<br><span style="display:inline-block; font-weight:bold; font-size:11px; color:#069; margin-top:3px">Tỷ lệ chốt trúng:</span>';if(typeof(chot.ratio.lo)!="undefined"){chotuserinfo+="<br>Lô: "+Math.round(chot.ratio.lo[0]*10000/chot.ratio.lo[1])/100+"% ("+chot.ratio.lo[0]+"/"+chot.ratio.lo[1]+")"}if(typeof(chot.ratio.lobt)!="undefined"){chotuserinfo+="<br>BTL: "+Math.round(chot.ratio.lobt[0]*10000/chot.ratio.lobt[1])/100+"% ("+chot.ratio.lobt[0]+"/"+chot.ratio.lobt[1]+")"}if(typeof(chot.ratio.de)!="undefined"){chotuserinfo+="<br>ĐB: "+Math.round(chot.ratio.de[0]*10000/chot.ratio.de[1])/100+"% ("+chot.ratio.de[0]+"/"+chot.ratio.de[1]+")"}if(typeof(chot.ratio.debt)!="undefined"){chotuserinfo+="<br>BTĐ: "+Math.round(chot.ratio.debt[0]*10000/chot.ratio.debt[1])/100+"% ("+chot.ratio.debt[0]+"/"+chot.ratio.debt[1]+")"}}chotuserinfo+="</div>";var linecontent='<span style="display:none" class="chotcreatetime">'+chot.ct+'</span> <span style="display:none" class="chotupdatetime">'+chot.ut+'</span> <span class="chotname tip new" id="chotuser_'+chot.uid+"\" rel='"+chotuserinfo+"'>"+chot.name+'</span> <span class="chottime" title="Chốt lúc '+timeshow(chot.ct)+'">('+(chot.ut>0?"Sửa: ":"Chốt: ")+timeshow(chot.ut>0?chot.ut:chot.ct)+')</span><div class="clear"></div>';if(chot.lo.length||chot.lodau.length||chot.lodit.length||chot.lobt.length){linecontent+=' <span class="chotline_lo">Lô:</span>&nbsp;'}if(chot.lo.length){if(re.nums){var str="";for(j in chot.lo){if(str){str+=", "}var kqso=solo(re.nums,chot.lo[j]);if(kqso[0]){str+=chot.lo[j]+'<sup class="clnhay">'+kqso[0]+"</sup>";trunglo=1}else{str+=chot.lo[j]}}linecontent+=str}else{linecontent+=chot.lo.join(", ")}}if(chot.lodau.length){var str="";if(re.nums){for(j in chot.lodau){if(str){str+=", "}var kqso=sodau(re.nums,chot.lodau[j]);if(kqso[0]){str+=chot.lodau[j]+'<sup class="clnhay">'+kqso[0]+"</sup>"}else{str+=chot.lodau[j]}}}else{str=chot.lodau.join(", ")}linecontent+=' <span class="chotline_lodau">đầu</span>&nbsp;'+str}if(chot.lodit.length){var str="";if(re.nums){for(j in chot.lodit){if(str){str+=", "}var kqso=sodit(re.nums,chot.lodit[j]);if(kqso[0]){str+=chot.lodit[j]+'<sup class="clnhay">'+kqso[0]+"</sup>"}else{str+=chot.lodit[j]}}}else{str=chot.lodit.join(", ")}linecontent+=' <span class="chotline_lodit">đuôi</span>&nbsp;'+str}if(chot.lobt.length){var str="";if(re.nums){var kqso=solo(re.nums,chot.lobt);if(kqso[0]){str=chot.lobt+'<sup class="clnhay">'+kqso[0]+"</sup>";trunglo=1}else{str=chot.lobt}}else{str=chot.lobt}linecontent+=' <span class="chotline_lobt">BTL</span>&nbsp;'+str}if(chot.de.length||chot.dedau.length||chot.dedit.length||chot.debt.length){linecontent+=' <span class="chotline_de">ĐB:</span>&nbsp;'}if(chot.de.length){if(re.nums){var str="";for(j in chot.de){if(str){str+=", "}var kqso=solo(re.nums,chot.de[j]);if(kqso[1]){str+=chot.de[j]+'<sup class="cdnhay">'+kqso[1]+"</sup>";trungde=1}else{str+=chot.de[j]}}linecontent+=str}else{linecontent+=chot.de.join(", ")}}if(chot.dedau.length){var str="";if(re.nums){for(j in chot.dedau){if(str){str+=", "}var kqso=sodau(re.nums,chot.dedau[j]);if(kqso[1]){str+=chot.dedau[j]+'<sup class="cdnhay">'+kqso[1]+"</sup>"}else{str+=chot.dedau[j]}}}else{str=chot.dedau.join(", ")}linecontent+=' <span class="chotline_dedau">đầu</span>&nbsp;'+str}if(chot.dedit.length){var str="";if(re.nums){for(j in chot.dedit){if(str){str+=", "}var kqso=sodit(re.nums,chot.dedit[j]);if(kqso[1]){str+=chot.dedit[j]+'<sup class="cdnhay">'+kqso[1]+"</sup>"}else{str+=chot.dedit[j]}}}else{str=chot.dedit.join(", ")}linecontent+=' <span class="chotline_dedit">đuôi</span>&nbsp;'+str}if(chot.debt.length){var str="";if(re.nums){var kqso=solo(re.nums,chot.debt);if(kqso[1]){str=chot.debt+'<sup class="cdnhay">'+kqso[1]+"</sup>";trungde=1}else{str=chot.debt}}else{str=chot.debt}linecontent+=' <span class="chotline_debt">BTĐ</span>&nbsp;'+str}if(!$("#chotlistarea"+ngaychot+" > .chotline[rel="+chot.id+"]").length){(function(){var line=$('<div class="chotline '+(chot.rank*1>28.75?"chothight":"")+(init?"":" chotline_new")+(trunglo?" trunglo":"")+(trungde?" trungde":"")+'" rel="'+chot.id+'" uid="'+chot.uid+'">'+linecontent+"</div>");line.hover(function(){$(this).addClass("chotline_hover");if(window.isadmin||chuaquay(ngaychot)&&window.uid&&window.uid==$(this).attr("uid")){var thisid=$(this).attr("rel");var chotdelbutt=$("<a href='#' class=closebutton title='Xóa'>&nbsp;</a>");chotdelbutt.click(function(){if(confirm("Xóa chốt số?")){$(".chotline[rel="+thisid+"]").addClass("chotline_deleting");delchot(thisid)}return false});$(this).append(chotdelbutt)}},function(){$(this).removeClass("chotline_hover");if(window.isadmin||chuaquay(ngaychot)&&window.uid&&window.uid==$(this).attr("uid")){$(this).find(".closebutton").remove()}});$("#chotlistarea"+ngaychot).append(line);setTimeout(function(){line.removeClass("chotline_new")},5000);if(!init&&typeof(notify)!="undefined"){flipclass("#chotlisttbl"+ngaychot+" > .chotlisthead","headhilight",8);floatnotify($("<div><b>"+chot.name+"</b> vừa chốt số</div>"))}})();newchot=1}else{(function(){var line=$("#chotlistarea"+ngaychot+" > .chotline[rel="+chot.id+"]");if(trunglo){line.addClass("trunglo")}if(trungde){line.addClass("trungde")}line.html(linecontent);if(!init){line.addClass("chotline_update");setTimeout(function(){line.removeClass("chotline_update")},5000);flipclass("#chotlisttbl"+ngaychot+" > .chotlisthead","headhilight",8);if(typeof(notify)!="undefined"){floatnotify($("<div><b>"+chot.name+"</b> vừa cập nhật chốt số</div>"))}}})()}}chotuserinit();hovertip(".chotname.new");$(".chotname.new").removeClass("new");if(newchot){chotcountupdate(ngaychot)}}if(update){setTimeout(function(){chotlist(ngaychot)},chotlist_intv)}},error:function(xhr){if(xhr.statusText!="abort"){if(update||init){setTimeout(function(){chotlist(ngaychot,init)},chotlist_timeout)}}}})}}function showchotlist(a,c){if($("#chotlisttbl"+a).length){$("#"+c).find(".chotlisttbl").hide();$("#chotlisttbl"+a).show()}else{var b="<div id='chotlisttbl"+a+"' class='chotlisttbl"+(chuaquay(a)?"":" chotlisttbl_old")+"'>";b+="<div class='chotlisthead'>Bảng chốt số ngày "+normaldate(a)+" <span class='chotcount'></span></div>";b+="<div id='chotlistarea"+a+"' class=chotlistarea><center class='loadingimg'><img src='"+staticdir+"public/client/images/loading3.gif' /></center></div>";b+="</div>";if(c){$("#"+c).find(".chotlisttbl").hide();$("#"+c).append(b)}else{$("#chotshowarea").append(b)}chotlist(a,1)}}function chotcountupdate(a){$("#chotlisttbl"+a+" > .chotlisthead > .chotcount").html("("+$("#chotlistarea"+a+" > .chotline").length+")")}function voteinit(){$(".voteup.new").hover(function(){$(this).addClass("vote_hover")},function(){$(this).removeClass("vote_hover")});$(".voteup.new").click(function(){if(!$(this).hasClass("vote_click")){if(curruser){$(this).addClass("vote_click");votechot($(this).attr("rel"),1)}else{alert("Bạn phải đăng nhập mới có thể đánh giá chốt số")}}});$(".votedown.new").hover(function(){$(this).addClass("vote_hover")},function(){$(this).removeClass("vote_hover")});$(".votedown.new").click(function(){if(!$(this).hasClass("vote_click")){if(curruser){$(this).addClass("vote_click");votechot($(this).attr("rel"),-1)}else{alert("Bạn phải đăng nhập mới có thể đánh giá chốt số")}}});$(".voteup.new").removeClass("new");$(".votedown.new").removeClass("new")}function votechot(b,a){$.ajax({url:uri_root+"client/chat/vote?type=chot&itemid="+b+"&vote="+a,success:function(c){if(c.length){$(".votes[rel="+b+"]").html(c);if(c>0){$(".votes[rel="+b+"]").removeClass("neg");$(".votes[rel="+b+"]").addClass("pos")}else{$(".votes[rel="+b+"]").removeClass("pos");$(".votes[rel="+b+"]").addClass("neg")}}}})}function chotuserinit(){$(".chotname.new").click(function(){var a=$(this).attr("id");a=a.replace("chotuser_","");var b=$(this).html();if(typeof(ppchatInit)!="undefined"){ppchatInit(a,b,0,1)}})}function delchot(id){$.ajax({url:uri_root+"chat_chot?del="+id,success:function(html){var re=eval("("+html+")");if(re.deleted>0){$(".chotline[rel="+re.deleted+"]").remove()}else{if(re.error==1){alert("Không xóa được")}}}})};